<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wenziyue.blog.dal.mapper.CommentLikeMapper">

    <!-- 幂等批量插入：主键冲突则 no-op -->
    <insert id="insertIgnoreBatch">
        INSERT INTO TB_WZY_BLOG_COMMENT_LIKE (comment_id, user_id)
        VALUES
        <foreach collection="items" item="it" separator=",">
            (#{it.commentId}, #{it.userId})
        </foreach>
        ON DUPLICATE KEY UPDATE comment_id = comment_id
    </insert>

    <!-- 批量删除：多列 IN（MySQL 支持 tuple IN） -->
    <delete id="deleteBatch">
        DELETE FROM TB_WZY_BLOG_COMMENT_LIKE
        WHERE (comment_id, user_id) IN
        <foreach collection="items" item="it" open="(" separator="," close=")">
            (#{it.commentId}, #{it.userId})
        </foreach>
    </delete>

    <!-- 批量查询：多列 IN（MySQL 支持 tuple IN） -->
    <select id="selectExistingPairs" resultType="com.wenziyue.blog.dal.entity.CommentLikeEntity">
        SELECT comment_id, user_id
        FROM TB_WZY_BLOG_COMMENT_LIKE
        WHERE (comment_id, user_id) IN
        <foreach collection="items" item="it" open="(" separator="," close=")">
            (#{it.commentId}, #{it.userId})
        </foreach>
    </select>

</mapper>